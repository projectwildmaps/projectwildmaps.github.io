<!DOCTYPE html>
<html>

<head>
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
	<title>PMAPS: PWILD Marking/Annotating Pisgah Systematically</title>
	<link rel="shortcut icon" href="favicon.ico" />
	<link type="text/css" rel="stylesheet" href="style.css" />

	<!-- these scripts should load before the ones at the end of the body do -->
	<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDfSBibzyTDahkTrbF19v4Ch9sP_96gb-U"></script>
	<script type="text/javascript" src="https://www.google.com/jsapi"></script>
	<script type="text/javascript">
		google.load('visualization', '1', { packages: ["map", "table"] });
	</script>
</head>

<body>
	<!--Content of the input form, gets moved from here into the input form info window
		the first time the user opens the form. Doing it this way instead of a content string
		so that we can use addEventListener for the submit button-->
	<div id="input_form_content">
		<label for='name'>Your Name: </label><br>
		<input type='text' id='name' class='input_field' />

		<label for='markerDescription'>Marker Description:</label><br>
		<textarea id='markerDescription' class='input_field' style="height: 100px; width: 260px;"></textarea>

		<label for='categories'>Category:</label><br>
		<input list='category' id='categories' class='input_field'>
		<datalist id='category'></datalist> <!--populated in init()-->

		<input id='submit' type='button' value='Save & Close' />
	</div>


	<div id="map"></div>
	<div id="legend">
		<b>Legend</b>
	</div>

	<div id="instructions_container">
		<div id="instructions">
			<div id="instruction_scroll_content">
				Hoka Hey!
				<p>Welcome to PMAPS, blah blah blah</p>
			</div>
			<button id="close_instructions"
				onclick="document.getElementById('instructions_container').style.display='none'">
				Let's Go!
			</button>
		</div>
	</div>


	<script>
		// GLOBAL CONFIG (you can change)
		var center_coords = new google.maps.LatLng(35.292621, -82.833716);
		var categories = [
			'VAM (View Appreciation Moment)',
			'Waterfall',
			'Water',
			'Safety',
			'Campsite',
			'Pro-Tip!',
			'Landmark',
			'Funny Story',
			'Solos',
			'Other' //default, doesn't get special treatment in getDot()
		];

		// GLOBALS (not config, only code should mess with these)
		var map;
		var markers = {}; //stores the marker features, format "database_key": Feature object. Allows getting a marker by the database key for when we need to modify it.
		var markerLayer; //global because legend.js needs to see this
		var trailLayer;
		var archived_visible = false; //legend.js and archive button use this

		//other globals defined in more relevant scripts
		//dataInfoWindow - see dataInfoWindow.js
		//inputInfoWindow - see inputInfoWindow.js
		//usersMarker - see inputInfoWindow.js
	</script>

	<script src="detect_mobile.js"></script>
	<script src="map_definitions.js"></script>
	<script src="getDot.js"></script>
	<script src="dataInfoWindow.js"></script>
	<script src="inputInfoWindow.js"></script>
	<script src="legend.js"></script>
	<script src="autopan.js"></script>
	<script src="trails.js"></script>

	<!--Firebase is module-based, so need a module script tag. Note that js treats module scripts
		as their own scope, so nothing declared in here is in the global scope.-->
	<script type="module">
		//SET UP FIREBASE DATABASE ---------------------------------------------------

		// Import the functions you need from the SDKs you need
		import { initializeApp } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-app.js";
		import { initializeAppCheck, ReCaptchaV3Provider } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-app-check.js"
		import { getDatabase, ref, onChildAdded, onChildChanged, onChildRemoved, update, push } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-database.js";

		// Your web app's Firebase configuration
		// For Firebase JS SDK v7.20.0 and later, measurementId is optional
		const firebaseConfig = {
			apiKey: "AIzaSyBB0sKq5KVASNFDmL9mxk2ZNXIcAevAwy8",
			authDomain: "pmaps-9b073.firebaseapp.com",
			projectId: "pmaps-9b073",
			storageBucket: "pmaps-9b073.appspot.com",
			messagingSenderId: "359127963683",
			appId: "1:359127963683:web:0dd617799d832f5b77f996",
			measurementId: "G-JKPFPGX204"
		};

		// Initialize Firebase
		const app = initializeApp(firebaseConfig);
		const database = getDatabase(app);
		/*const appCheck = initializeAppCheck(app, {
				provider: new ReCaptchaV3Provider('6Lc-dTUjAAAAAOQFOlQaN6w81vK1Eso4oflV1sZk'),
			isTokenAutoRefreshEnabled: true
		});*/

		// Exposing certain functions and variables to the global scope that I want to use outside this script tag,
		// since module script tags don't operate in the global scope
		window.ref = ref;
		window.onChildAdded = onChildAdded;
		window.onChildChanged = onChildChanged;
		window.onChildRemoved = onChildRemoved;
		window.update = update;
		window.push = push;

		window.database = database;
	</script>

	<script src="init.js"></script>
	<script>
		window.addEventListener("load", init);
	</script>
</body>

</html>