<!DOCTYPE html>
<html>

<head>
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
	<title>PMAPS: PWILD Marking/Annotating Pisgah Systematically</title>
	<link rel="shortcut icon" href="favicon.ico" />
	<link type="text/css" rel="stylesheet" href="style.css" />
	<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Open+Sans&family=Oleo+Script&family=Rock+Salt">


	<!-- these scripts should load before the ones at the end of the body do -->
	<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDfSBibzyTDahkTrbF19v4Ch9sP_96gb-U"></script>
	<script type="text/javascript" src="https://www.google.com/jsapi"></script>
	<script type="text/javascript">
		google.load('visualization', '1', { packages: ["map", "table"] });
	</script>
</head>

<body>
	<!-- div to hold HTML we'll move into the map later, shouldn't display until then -->
	<div style="display: none;">
		<!--Content of the input form, gets moved from here into the input form info window
		the first time the user opens the form. Doing it this way instead of a content string
		so that we can use addEventListener for the submit button-->
		<div id="input_form_content">
			<label for='name'>Your Name: </label><br>
			<input type='text' id='name' class='input_field' />

			<label for='markerDescription'>Marker Description:</label><br>
			<textarea id='markerDescription' class='input_field' style="height: 100px; width: 260px;"></textarea>

			<label for='categories'>Category:</label><br>
			<input list='category' id='categories' class='input_field'>
			<datalist id='category'></datalist> <!-- populated in init.js -->

			<input id='submit' type='button' value='Save & Close' />
		</div>

		<div id="legend" class="custom_map_control"> <!-- populated in legend.js initLegend() -->
			<b>Legend</b>
		</div>
		<div id="download_data" class="custom_map_control"> <!-- this is set up in init.js -->
			Download<br>
			Data
		</div>
		<div id="change_location"> <!-- This is set up in init.js. Styling copied from google's dropdown -->
			<button id="change_location_button">
				<span>Location</span>
				<img src="https://maps.gstatic.com/mapfiles/arrow-down.png">
			</button>
			<ul id="locations"></ul>
		</div>
		<div id="info_control" class="custom_map_control">i</div> <!-- opens the instructions panel -->
	</div>


	<div id="map"></div>

	<dialog id="instructions">
		<div id="instructions_vertical_layout">
			<div id="instruction_scroll_content">
				<div id="instructions_header">
					<h1 id="hoka">Hoka Hey!</h1>
					<div>
						<img src="instructions_images/backpacker.png" alt="">
						<img src="instructions_images/mountain.png" alt="">
						<img src="instructions_images/compass3.png" alt="">
					</div>
				</div>
				
				<p>Welcome to PMAPS!!! This is an online tool for recording information about locations in Pisgah National Forest (and other ~PWILDy~ places). This allows our knowledge to be shared among generations of PWILDers, despite that pesky thing called graduation.</p>
	
				<div class="text-img-flex">
					<p><b>Note:</b> You can come back to these instructions at any time by clicking the info icon at the right of the map.</p>
					<div style="display: flex; align-items: center; gap: 10px;">
						<img style="width: 50px;" src="instructions_images/info_icon.png" alt="screenshot of the info icon">
						<p><b>The info<br>icon</b></p>
					</div>
				</div>

				<h2>How to Use</h2>

				<div class="text-img-flex">
					<p>Click on a point to read the information about that point. The category, description, contributor, and date are displayed, along with comments if they exist (see Figure 1). You can add a new comment by clicking "Add Comment", which will open a form allowing you to enter your name and your comment.</p>
				
					<div>
						<img src="instructions_images/point_info.png" alt="screenshot of a data point's information">
						<p style="text-align: center;"><b>Figure 1</b></p>
					</div>
				</div>
				
				<div class="text-img-flex">
					<p>To add a new point, click and drag the big red pin to the location you wish to mark. Click the pin to open the data entry form (see Figure 2). Enter your name, what you want to say about that location, and a category. For the category, click on the category input to select one from the dropdown, or if none of the existing categories fits, you can instead type in a custom category. Click "Save & Close" to add the point.</p>
					<div>
						<img src="instructions_images/input_form.png" alt="screenshot of the input form">
						<p style="text-align: center;"><b>Figure 2</b></p>
					</div>
				</div>

				<h2>Other Things</h2>

				<p><b>Maps and Locations - </b>You can change the map type using the dropdown in the top left. You can jump to different PWILD-related locations using the location dropdown in the top left.</p>

				<p><b>The Legend - </b> The legend allows you to filter points by category. Checking / unchecking a category will show/hide all points belonging to it.</p>

				<p><b>Archiving Points - </b>Archiving a point hides it from view by default. This is used if you want to remove a point for any reason (e.g. if a point is outdated / no longer accurate). To archive a point, click on it and then click "Archive." To unarchive a point, click "show archived points" in the legend, click the point (it will be displayed as a gray circle with an x through it), then click "Unarchive."</p>

				<p><b>Editing Points - </b>There is currently no way to edit a submitted point directly, since this app is accessible to the public and we want to protect the data from being messed with or deleted. Instead, you have to archive the old point and make a new one.</p>

			</div>
			<button id="close_instructions" onclick="document.getElementById('instructions').close()">
				<img src="instructions_images/wood_sign.png">
				<div>Let's Go!</div>
			</button>
		</div>
	</dialog>


	<script>
		// GLOBAL CONFIG (you can change)
		var default_zoom_level = 13; // uses this if zoom not specified in the default location below

		// Locations we can switch to. The only required property is coords
		// mapTypeId, if specified, is the map to switch to ("roadmap", "satellite", "Nat Geo", etc)
		// zoom, if specified, is the default zoom level for this location (bigger = more zoomed in)
		// The default location has the default property set to true (exactly one location must have this)
		var locations = {
			"Pisgah": {
				coords: new google.maps.LatLng(35.292621, -82.833716),
				mapTypeId: "Nat Geo",
				zoom: 13,
				default: true
			},
			"Duke": {
				coords: new google.maps.LatLng(36.001046, -78.938461),
				mapTypeId: "roadmap",
				zoom: 13
			},
			"Camp Raven Knob": {
				coords: new google.maps.LatLng(36.482337, -80.861160),
				mapTypeId: "terrain",
				zoom: 14
			}
		}

		var categories = [
			'VAM (View Appreciation Moment)',
			'Waterfall',
			'Water',
			'Safety',
			'Campsite',
			'Pro-Tip!',
			'Landmark',
			'Funny Story',
			'Solos',
			'Other' //default, doesn't get special treatment in getDot()
		];

		// GLOBALS (not config, only code should mess with these)
		var map;
		var markers = {}; //stores the marker features, format "database_key": Feature object. Allows getting a marker by the database key for when we need to modify it.
		var markerLayer; //global because legend.js needs to see this
		var trailLayer;
		var archived_visible = false; //legend.js and archive button use this

		/*other globals defined in more relevant scripts
			dataInfoWindow - see dataInfoWindow.js
			inputInfoWindow - see inputInfoWindow.js
			usersMarker - see inputInfoWindow.js
		*/
	</script>

	<script src="detect_mobile.js"></script>
	<script src="map_definitions.js"></script>
	<script src="getDot.js"></script>
	<script src="dataInfoWindow.js"></script>
	<script src="inputInfoWindow.js"></script>
	<script src="legend.js"></script>
	<script src="autopan.js"></script>
	<script src="trails.js"></script>

	<!--Firebase is module-based, so need a module script tag. Note that js treats module scripts
		as their own scope, so nothing declared in here is in the global scope.-->
	<script type="module">
		//SET UP FIREBASE DATABASE ---------------------------------------------------

		// Import the functions you need from the SDKs you need
		import { initializeApp } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-app.js";
		import { initializeAppCheck, ReCaptchaV3Provider } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-app-check.js"
		import { getDatabase, ref, child, onChildAdded, onChildChanged, onChildRemoved, update, push, get } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-database.js";

		// Your web app's Firebase configuration
		// For Firebase JS SDK v7.20.0 and later, measurementId is optional
		const firebaseConfig = {
			apiKey: "AIzaSyBB0sKq5KVASNFDmL9mxk2ZNXIcAevAwy8",
			authDomain: "pmaps-9b073.firebaseapp.com",
			projectId: "pmaps-9b073",
			storageBucket: "pmaps-9b073.appspot.com",
			messagingSenderId: "359127963683",
			appId: "1:359127963683:web:0dd617799d832f5b77f996",
			measurementId: "G-JKPFPGX204"
		};

		// Initialize Firebase
		const app = initializeApp(firebaseConfig);
		const database = getDatabase(app);
		/*const appCheck = initializeAppCheck(app, {
				provider: new ReCaptchaV3Provider('6Lc-dTUjAAAAAOQFOlQaN6w81vK1Eso4oflV1sZk'),
			isTokenAutoRefreshEnabled: true
		});*/

		// Exposing certain functions and variables to the global scope that I want to use outside this script tag,
		// since module script tags don't operate in the global scope
		window.ref = ref;
		window.child = child;
		window.onChildAdded = onChildAdded;
		window.onChildChanged = onChildChanged;
		window.onChildRemoved = onChildRemoved;
		window.update = update;
		window.push = push;
		window.get = get;

		window.database = database;
	</script>

	<script src="init.js"></script>
	<script>
		window.addEventListener("load", init);
	</script>
</body>

</html>